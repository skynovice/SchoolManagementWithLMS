import{S as qe,i as Ne,s as Se,n as ae,d as u,a as z,b as q,c as o,w as d,e as b,f as C,g as T,h as N,j as p,t as j,k as S,r as Ae,D as K,G as Pe,H as ze,F as ve,q as De}from"../chunks/BVH3f4ly.js";import{e as we}from"../chunks/CtnloIfX.js";import"../chunks/IHki7fMi.js";import{s as J}from"../chunks/DtlnWW8f.js";import{g as Be}from"../chunks/BP_01uF4.js";function Ie(i,e,s){const t=i.slice();return t[14]=e[s],t}function Ve(i){let e,s="‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà";return{c(){e=p("a"),e.textContent=s,this.h()},l(t){e=b(t,"A",{href:!0,class:!0,"data-svelte-h":!0}),K(e)!=="svelte-1od1c1b"&&(e.textContent=s),this.h()},h(){d(e,"href","/courses/create"),d(e,"class","btn-primary svelte-i9l6m2")},m(t,r){q(t,e,r)},d(t){t&&u(e)}}}function He(i){let e,s=we(i[2]),t=[];for(let r=0;r<s.length;r+=1)t[r]=ye(Ie(i,s,r));return{c(){e=p("div");for(let r=0;r<t.length;r+=1)t[r].c();this.h()},l(r){e=b(r,"DIV",{class:!0});var a=C(e);for(let l=0;l<t.length;l+=1)t[l].l(a);a.forEach(u),this.h()},h(){d(e,"class","courses-grid svelte-i9l6m2")},m(r,a){q(r,e,a);for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(e,null)},p(r,a){if(a&247){s=we(r[2]);let l;for(l=0;l<s.length;l+=1){const c=Ie(r,s,l);t[l]?t[l].p(c,a):(t[l]=ye(c),t[l].c(),t[l].m(e,null))}for(;l<t.length;l+=1)t[l].d(1);t.length=s.length}},d(r){r&&u(e),Pe(t,r)}}}function Oe(i){var c,f;let e,s,t=((c=i[1])==null?void 0:c.role)==="teacher"?"‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£":"‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö",r,a,l=((f=i[1])==null?void 0:f.role)==="teacher"&&Te();return{c(){e=p("div"),s=p("p"),r=j(t),a=S(),l&&l.c(),this.h()},l(k){e=b(k,"DIV",{class:!0});var h=C(e);s=b(h,"P",{class:!0});var v=C(s);r=T(v,t),v.forEach(u),a=N(h),l&&l.l(h),h.forEach(u),this.h()},h(){d(s,"class","svelte-i9l6m2"),d(e,"class","empty-state svelte-i9l6m2")},m(k,h){q(k,e,h),o(e,s),o(s,r),o(e,a),l&&l.m(e,null)},p(k,h){var v,I;h&2&&t!==(t=((v=k[1])==null?void 0:v.role)==="teacher"?"‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£":"‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö")&&z(r,t),((I=k[1])==null?void 0:I.role)==="teacher"?l||(l=Te(),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},d(k){k&&u(e),l&&l.d()}}}function Ue(i){let e,s="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";return{c(){e=p("div"),e.textContent=s,this.h()},l(t){e=b(t,"DIV",{class:!0,"data-svelte-h":!0}),K(e)!=="svelte-whnzab"&&(e.textContent=s),this.h()},h(){d(e,"class","loading svelte-i9l6m2")},m(t,r){q(t,e,r)},p:ae,d(t){t&&u(e)}}}function Fe(i){let e,s;function t(l,c){return c&4&&(e=null),e==null&&(e=!!l[7](l[14])),e?Me:Ge}let r=t(i,-1),a=r(i);return{c(){a.c(),s=De()},l(l){a.l(l),s=De()},m(l,c){a.m(l,c),q(l,s,c)},p(l,c){r===(r=t(l,c))&&a?a.p(l,c):(a.d(1),a=r(l),a&&(a.c(),a.m(s.parentNode,s)))},d(l){l&&u(s),a.d(l)}}}function Le(i){let e,s,t,r,a,l=i[14].is_published?"üì§ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà":"üì¢ ‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà",c,f,k,h,v="üóëÔ∏è ‡∏•‡∏ö",I,A;function m(){return i[9](i[14])}function D(){return i[10](i[14])}return{c(){e=p("a"),s=j("‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"),r=S(),a=p("button"),c=j(l),k=S(),h=p("button"),h.textContent=v,this.h()},l(_){e=b(_,"A",{href:!0,class:!0});var n=C(e);s=T(n,"‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"),n.forEach(u),r=N(_),a=b(_,"BUTTON",{class:!0});var E=C(a);c=T(E,l),E.forEach(u),k=N(_),h=b(_,"BUTTON",{class:!0,"data-svelte-h":!0}),K(h)!=="svelte-17h94as"&&(h.textContent=v),this.h()},h(){d(e,"href",t="/lms/edit/"+i[14].id),d(e,"class","btn-small btn-edit svelte-i9l6m2"),d(a,"class",f="btn-small "+(i[14].is_published?"btn-unpublish":"btn-publish")+" svelte-i9l6m2"),d(h,"class","btn-small btn-delete svelte-i9l6m2")},m(_,n){q(_,e,n),o(e,s),q(_,r,n),q(_,a,n),o(a,c),q(_,k,n),q(_,h,n),I||(A=[ve(a,"click",m),ve(h,"click",D)],I=!0)},p(_,n){i=_,n&4&&t!==(t="/lms/edit/"+i[14].id)&&d(e,"href",t),n&4&&l!==(l=i[14].is_published?"üì§ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà":"üì¢ ‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà")&&z(c,l),n&4&&f!==(f="btn-small "+(i[14].is_published?"btn-unpublish":"btn-publish")+" svelte-i9l6m2")&&d(a,"class",f)},d(_){_&&(u(e),u(r),u(a),u(k),u(h)),I=!1,ze(A)}}}function Ge(i){let e,s="üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô",t,r;function a(){return i[11](i[14])}return{c(){e=p("button"),e.textContent=s,this.h()},l(l){e=b(l,"BUTTON",{class:!0,"data-svelte-h":!0}),K(e)!=="svelte-zsr2kz"&&(e.textContent=s),this.h()},h(){d(e,"class","btn-small btn-enroll svelte-i9l6m2")},m(l,c){q(l,e,c),t||(r=ve(e,"click",a),t=!0)},p(l,c){i=l},d(l){l&&u(e),t=!1,r()}}}function Me(i){let e,s="‚úÖ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß";return{c(){e=p("button"),e.textContent=s,this.h()},l(t){e=b(t,"BUTTON",{class:!0,"data-svelte-h":!0}),K(e)!=="svelte-x2xjs1"&&(e.textContent=s),this.h()},h(){d(e,"class","btn-small btn-enrolled svelte-i9l6m2"),e.disabled=!0},m(t,r){q(t,e,r)},p:ae,d(t){t&&u(e)}}}function ye(i){var be,pe;let e,s,t,r=i[14].title+"",a,l,c,f=((be=i[14].subjects)==null?void 0:be.code)+"",k,h,v=((pe=i[14].subjects)==null?void 0:pe.name)+"",I,A,m,D,_=(i[14].description||"‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢")+"",n,E,y,H,F,Q=i[14].is_published?"‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÅ‡∏•‡πâ‡∏ß":"‡∏£‡πà‡∏≤‡∏á",Y,Z,ne,L,oe,R=je(i[14])+"",$,ce,ue,W,X=new Date(i[14].created_at).toLocaleDateString("th-TH")+"",x,de,B,O,fe,ee,he,_e;function me(g,w){var P,U;if(((P=g[1])==null?void 0:P.role)==="teacher"&&g[14].teacher_id===g[0].id)return Le;if(((U=g[1])==null?void 0:U.role)==="student")return Fe}let G=me(i),V=G&&G(i);return{c(){e=p("div"),s=p("div"),t=p("div"),a=j(r),l=S(),c=p("div"),k=j(f),h=j(" - "),I=j(v),A=S(),m=p("div"),D=p("div"),n=j(_),E=S(),y=p("div"),H=p("div"),F=p("span"),Y=j(Q),ne=S(),L=p("span"),oe=j("üë• "),$=j(R),ce=j(" ‡∏Ñ‡∏ô"),ue=S(),W=p("div"),x=j(X),de=S(),B=p("div"),O=p("a"),fe=j("üëÅÔ∏è ‡∏î‡∏π"),he=S(),V&&V.c(),_e=S(),this.h()},l(g){e=b(g,"DIV",{class:!0});var w=C(e);s=b(w,"DIV",{class:!0});var P=C(s);t=b(P,"DIV",{class:!0});var U=C(t);a=T(U,r),U.forEach(u),l=N(P),c=b(P,"DIV",{class:!0});var te=C(c);k=T(te,f),h=T(te," - "),I=T(te,v),te.forEach(u),P.forEach(u),A=N(w),m=b(w,"DIV",{class:!0});var M=C(m);D=b(M,"DIV",{class:!0});var ke=C(D);n=T(ke,_),ke.forEach(u),E=N(M),y=b(M,"DIV",{class:!0});var le=C(y);H=b(le,"DIV",{class:!0});var se=C(H);F=b(se,"SPAN",{class:!0});var ge=C(F);Y=T(ge,Q),ge.forEach(u),ne=N(se),L=b(se,"SPAN",{});var re=C(L);oe=T(re,"üë• "),$=T(re,R),ce=T(re," ‡∏Ñ‡∏ô"),re.forEach(u),se.forEach(u),ue=N(le),W=b(le,"DIV",{});var Ee=C(W);x=T(Ee,X),Ee.forEach(u),le.forEach(u),de=N(M),B=b(M,"DIV",{class:!0});var ie=C(B);O=b(ie,"A",{href:!0,class:!0});var Ce=C(O);fe=T(Ce,"üëÅÔ∏è ‡∏î‡∏π"),Ce.forEach(u),he=N(ie),V&&V.l(ie),ie.forEach(u),M.forEach(u),_e=N(w),w.forEach(u),this.h()},h(){d(t,"class","course-title svelte-i9l6m2"),d(c,"class","course-subject svelte-i9l6m2"),d(s,"class","course-header svelte-i9l6m2"),d(D,"class","course-description svelte-i9l6m2"),d(F,"class",Z="status-badge "+(i[14].is_published?"status-published":"status-draft")+" svelte-i9l6m2"),d(H,"class","course-status svelte-i9l6m2"),d(y,"class","course-meta svelte-i9l6m2"),d(O,"href",ee="/lms/course/"+i[14].id),d(O,"class","btn-small btn-view svelte-i9l6m2"),d(B,"class","course-actions svelte-i9l6m2"),d(m,"class","course-body svelte-i9l6m2"),d(e,"class","course-card svelte-i9l6m2")},m(g,w){q(g,e,w),o(e,s),o(s,t),o(t,a),o(s,l),o(s,c),o(c,k),o(c,h),o(c,I),o(e,A),o(e,m),o(m,D),o(D,n),o(m,E),o(m,y),o(y,H),o(H,F),o(F,Y),o(H,ne),o(H,L),o(L,oe),o(L,$),o(L,ce),o(y,ue),o(y,W),o(W,x),o(m,de),o(m,B),o(B,O),o(O,fe),o(B,he),V&&V.m(B,null),o(e,_e)},p(g,w){var P,U;w&4&&r!==(r=g[14].title+"")&&z(a,r),w&4&&f!==(f=((P=g[14].subjects)==null?void 0:P.code)+"")&&z(k,f),w&4&&v!==(v=((U=g[14].subjects)==null?void 0:U.name)+"")&&z(I,v),w&4&&_!==(_=(g[14].description||"‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢")+"")&&z(n,_),w&4&&Q!==(Q=g[14].is_published?"‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÅ‡∏•‡πâ‡∏ß":"‡∏£‡πà‡∏≤‡∏á")&&z(Y,Q),w&4&&Z!==(Z="status-badge "+(g[14].is_published?"status-published":"status-draft")+" svelte-i9l6m2")&&d(F,"class",Z),w&4&&R!==(R=je(g[14])+"")&&z($,R),w&4&&X!==(X=new Date(g[14].created_at).toLocaleDateString("th-TH")+"")&&z(x,X),w&4&&ee!==(ee="/lms/course/"+g[14].id)&&d(O,"href",ee),G===(G=me(g))&&V?V.p(g,w):(V&&V.d(1),V=G&&G(g),V&&(V.c(),V.m(B,null)))},d(g){g&&u(e),V&&V.d()}}}function Te(i){let e,s="‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏£‡∏Å";return{c(){e=p("a"),e.textContent=s,this.h()},l(t){e=b(t,"A",{href:!0,class:!0,"data-svelte-h":!0}),K(e)!=="svelte-dx7zj"&&(e.textContent=s),this.h()},h(){d(e,"href","/courses/create"),d(e,"class","btn-primary svelte-i9l6m2")},m(t,r){q(t,e,r)},d(t){t&&u(e)}}}function Je(i){var I,A;let e,s,t,r=((I=i[1])==null?void 0:I.role)==="teacher"?"‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô":"‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",a,l,c,f=((A=i[1])==null?void 0:A.role)==="teacher"&&Ve();function k(m,D){return m[3]?Ue:m[2].length===0?Oe:He}let h=k(i),v=h(i);return{c(){e=p("div"),s=p("div"),t=p("h1"),a=j(r),l=S(),f&&f.c(),c=S(),v.c(),this.h()},l(m){e=b(m,"DIV",{class:!0});var D=C(e);s=b(D,"DIV",{class:!0});var _=C(s);t=b(_,"H1",{class:!0});var n=C(t);a=T(n,r),n.forEach(u),l=N(_),f&&f.l(_),_.forEach(u),c=N(D),v.l(D),D.forEach(u),this.h()},h(){d(t,"class","page-title svelte-i9l6m2"),d(s,"class","page-header svelte-i9l6m2"),d(e,"class","courses-container svelte-i9l6m2")},m(m,D){q(m,e,D),o(e,s),o(s,t),o(t,a),o(s,l),f&&f.m(s,null),o(e,c),v.m(e,null)},p(m,[D]){var _,n;D&2&&r!==(r=((_=m[1])==null?void 0:_.role)==="teacher"?"‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô":"‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î")&&z(a,r),((n=m[1])==null?void 0:n.role)==="teacher"?f||(f=Ve(),f.c(),f.m(s,null)):f&&(f.d(1),f=null),h===(h=k(m))&&v?v.p(m,D):(v.d(1),v=h(m),v&&(v.c(),v.m(e,null)))},i:ae,o:ae,d(m){m&&u(e),f&&f.d(),v.d()}}}function je(i){var e;return((e=i.course_enrollments)==null?void 0:e.length)||0}function Ke(i,e,s){const t={};let r=null,a=null,l=[],c=!0;Ae(async()=>{const{data:{session:n}}=await J.auth.getSession();if(!n){Be("/login");return}s(0,r=n.user),await f(),await k(),s(3,c=!1)});async function f(){if(!r)return;const{data:n}=await J.from("profiles").select("*").eq("id",r.id).single();s(1,a=n)}async function k(){if(r)try{let n=J.from("courses").select(`
          *,
          subjects (
            name,
            code
          ),
          course_enrollments (
            id,
            student_id
          )
        `);(a==null?void 0:a.role)==="teacher"?n=n.eq("teacher_id",r.id):n=n.eq("is_published",!0);const{data:E,error:y}=await n.order("created_at",{ascending:!1});if(y){console.error("Error loading courses:",y);return}E&&s(2,l=E)}catch(n){console.error("Failed to load courses:",n)}}async function h(n,E){const{error:y}=await J.from("courses").update({is_published:!E}).eq("id",n);y||await k()}async function v(n){if(confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ?")){const{error:E}=await J.from("courses").delete().eq("id",n);E||await k()}}async function I(n){try{const{error:E}=await J.from("course_enrollments").insert({course_id:n,student_id:r.id});E?(console.error("Enrollment error:",E),alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô: "+E.message)):(await k(),alert("‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!"))}catch(E){console.error("Failed to enroll:",E),alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô")}}function A(n){var E;return(E=n.course_enrollments)==null?void 0:E.some(y=>y.student_id===r.id)}return[r,a,l,c,h,v,I,A,t,n=>h(n.id,n.is_published),n=>v(n.id),n=>I(n.id)]}class Ze extends qe{constructor(e){super(),Ne(this,e,Ke,Je,Se,{params:8})}get params(){return this.$$.ctx[8]}}export{Ze as component};
