import{S as ae,i as ie,s as ne,n as K,d as u,H as oe,w as _,b as T,c as d,F as G,e as v,f as k,D as J,h as N,g as q,j as g,k as j,t as H,r as ce,a as L,G as de}from"../chunks/BVH3f4ly.js";import{e as ee}from"../chunks/CtnloIfX.js";import"../chunks/IHki7fMi.js";import{s as P}from"../chunks/DtlnWW8f.js";import{g as ue}from"../chunks/C5JyHtm3.js";function te(s,e,r){const l=s.slice();return l[12]=e[r],l[14]=r,l}function fe(s){let e,r=ee(s[0]),l=[];for(let a=0;a<r.length;a+=1)l[a]=se(te(s,r,a));return{c(){e=g("div");for(let a=0;a<l.length;a+=1)l[a].c();this.h()},l(a){e=v(a,"DIV",{class:!0});var i=k(e);for(let t=0;t<l.length;t+=1)l[t].l(i);i.forEach(u),this.h()},h(){_(e,"class","bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden")},m(a,i){T(a,e,i);for(let t=0;t<l.length;t+=1)l[t]&&l[t].m(e,null)},p(a,i){if(i&29){r=ee(a[0]);let t;for(t=0;t<r.length;t+=1){const o=te(a,r,t);l[t]?l[t].p(o,i):(l[t]=se(o),l[t].c(),l[t].m(e,null))}for(;t<l.length;t+=1)l[t].d(1);l.length=r.length}},d(a){a&&u(e),de(l,a)}}}function he(s){let e,r,l=s[2]==="inbox"?"ไม่มีข้อความในกล่องข้อความ":"ยังไม่ได้ส่งข้อความ",a;return{c(){e=g("div"),r=g("p"),a=H(l),this.h()},l(i){e=v(i,"DIV",{class:!0});var t=k(e);r=v(t,"P",{});var o=k(r);a=q(o,l),o.forEach(u),t.forEach(u),this.h()},h(){_(e,"class","text-center py-12 text-gray-600")},m(i,t){T(i,e,t),d(e,r),d(r,a)},p(i,t){t&4&&l!==(l=i[2]==="inbox"?"ไม่มีข้อความในกล่องข้อความ":"ยังไม่ได้ส่งข้อความ")&&L(a,l)},d(i){i&&u(e)}}}function _e(s){let e,r="กำลังโหลดข้อความ...";return{c(){e=g("div"),e.textContent=r,this.h()},l(l){e=v(l,"DIV",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-rxj1cc"&&(e.textContent=r),this.h()},h(){_(e,"class","text-center py-12 text-gray-600")},m(l,a){T(l,e,a)},p:K,d(l){l&&u(e)}}}function me(s){var y,n;let e,r,l=(((y=s[12].recipient)==null?void 0:y.full_name)||"ไม่ทราบชื่อ")+"",a,i,t,o=z((n=s[12].recipient)==null?void 0:n.role)+"",p;return{c(){e=g("div"),r=H("ถึง: "),a=H(l),i=j(),t=g("div"),p=H(o),this.h()},l(c){e=v(c,"DIV",{class:!0});var f=k(e);r=q(f,"ถึง: "),a=q(f,l),f.forEach(u),i=N(c),t=v(c,"DIV",{class:!0});var b=k(t);p=q(b,o),b.forEach(u),this.h()},h(){_(e,"class","font-semibold text-gray-900"),_(t,"class","text-sm text-gray-500")},m(c,f){T(c,e,f),d(e,r),d(e,a),T(c,i,f),T(c,t,f),d(t,p)},p(c,f){var b,V;f&1&&l!==(l=(((b=c[12].recipient)==null?void 0:b.full_name)||"ไม่ทราบชื่อ")+"")&&L(a,l),f&1&&o!==(o=z((V=c[12].recipient)==null?void 0:V.role)+"")&&L(p,o)},d(c){c&&(u(e),u(i),u(t))}}}function ve(s){var p,y;let e,r=(((p=s[12].sender)==null?void 0:p.full_name)||"ไม่ทราบชื่อ")+"",l,a,i,t=z((y=s[12].sender)==null?void 0:y.role)+"",o;return{c(){e=g("div"),l=H(r),a=j(),i=g("div"),o=H(t),this.h()},l(n){e=v(n,"DIV",{class:!0});var c=k(e);l=q(c,r),c.forEach(u),a=N(n),i=v(n,"DIV",{class:!0});var f=k(i);o=q(f,t),f.forEach(u),this.h()},h(){_(e,"class","font-semibold text-gray-900"),_(i,"class","text-sm text-gray-500")},m(n,c){T(n,e,c),d(e,l),T(n,a,c),T(n,i,c),d(i,o)},p(n,c){var f,b;c&1&&r!==(r=(((f=n[12].sender)==null?void 0:f.full_name)||"ไม่ทราบชื่อ")+"")&&L(l,r),c&1&&t!==(t=z((b=n[12].sender)==null?void 0:b.role)+"")&&L(o,t)},d(n){n&&(u(e),u(a),u(i))}}}function le(s){let e,r="ทำเครื่องหมายว่าอ่านแล้ว",l,a;function i(){return s[8](s[12])}return{c(){e=g("button"),e.textContent=r,this.h()},l(t){e=v(t,"BUTTON",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-11ranl0"&&(e.textContent=r),this.h()},h(){_(e,"class","bg-success text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition-colors")},m(t,o){T(t,e,o),l||(a=G(e,"click",i),l=!0)},p(t,o){s=t},d(t){t&&u(e),l=!1,a()}}}function se(s){let e,r,l,a,i,t=new Date(s[12].created_at).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})+"",o,p,y,n=s[12].subject+"",c,f,b,V=s[12].content+"",h,M,I,w,m,D="ลบ",B,O,U,Q;function W(S,x){return S[2]==="inbox"?ve:me}let R=W(s),C=R(s),E=s[2]==="inbox"&&!s[12].is_read&&le(s);function re(){return s[9](s[12])}return{c(){e=g("div"),r=g("div"),l=g("div"),C.c(),a=j(),i=g("div"),o=H(t),p=j(),y=g("div"),c=H(n),f=j(),b=g("div"),h=H(V),M=j(),I=g("div"),E&&E.c(),w=j(),m=g("button"),m.textContent=D,B=j(),this.h()},l(S){e=v(S,"DIV",{class:!0});var x=k(e);r=v(x,"DIV",{class:!0});var A=k(r);l=v(A,"DIV",{class:!0});var X=k(l);C.l(X),X.forEach(u),a=N(A),i=v(A,"DIV",{class:!0});var Y=k(i);o=q(Y,t),Y.forEach(u),A.forEach(u),p=N(x),y=v(x,"DIV",{class:!0});var Z=k(y);c=q(Z,n),Z.forEach(u),f=N(x),b=v(x,"DIV",{class:!0});var $=k(b);h=q($,V),$.forEach(u),M=N(x),I=v(x,"DIV",{class:!0});var F=k(I);E&&E.l(F),w=N(F),m=v(F,"BUTTON",{class:!0,"data-svelte-h":!0}),J(m)!=="svelte-1uc1orl"&&(m.textContent=D),F.forEach(u),B=N(x),x.forEach(u),this.h()},h(){_(l,"class","flex flex-col gap-1"),_(i,"class","text-sm text-gray-500"),_(r,"class","flex justify-between items-start mb-3"),_(y,"class","text-lg font-medium text-primary-800 mb-2"),_(b,"class","text-gray-600 leading-relaxed line-clamp-2 mb-3"),_(m,"class","bg-danger text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition-colors"),_(I,"class","flex gap-3"),_(e,"class",O="p-5 transition-colors hover:bg-gray-50 cursor-pointer "+(s[2]==="inbox"&&!s[12].is_read?"bg-gold-50 border-l-4 border-gold-500":"")+" "+(s[14]<s[0].length-1?"border-b border-gray-200":""))},m(S,x){T(S,e,x),d(e,r),d(r,l),C.m(l,null),d(r,a),d(r,i),d(i,o),d(e,p),d(e,y),d(y,c),d(e,f),d(e,b),d(b,h),d(e,M),d(e,I),E&&E.m(I,null),d(I,w),d(I,m),d(e,B),U||(Q=G(m,"click",re),U=!0)},p(S,x){s=S,R===(R=W(s))&&C?C.p(s,x):(C.d(1),C=R(s),C&&(C.c(),C.m(l,null))),x&1&&t!==(t=new Date(s[12].created_at).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})+"")&&L(o,t),x&1&&n!==(n=s[12].subject+"")&&L(c,n),x&1&&V!==(V=s[12].content+"")&&L(h,V),s[2]==="inbox"&&!s[12].is_read?E?E.p(s,x):(E=le(s),E.c(),E.m(I,w)):E&&(E.d(1),E=null),x&5&&O!==(O="p-5 transition-colors hover:bg-gray-50 cursor-pointer "+(s[2]==="inbox"&&!s[12].is_read?"bg-gold-50 border-l-4 border-gold-500":"")+" "+(s[14]<s[0].length-1?"border-b border-gray-200":""))&&_(e,"class",O)},d(S){S&&u(e),C.d(),E&&E.d(),U=!1,Q()}}}function ge(s){let e,r,l='<h1 class="text-3xl font-semibold text-gray-900">ข้อความ</h1> <a href="/messages/compose" class="bg-gold-500 hover:bg-gold-600 text-white font-medium px-6 py-2 rounded-lg transition-colors no-underline shadow-md">เขียนข้อความใหม่</a>',a,i,t,o,p,y,n,c,f,b,V,h;function M(m,D){return m[1]?_e:m[0].length===0?he:fe}let I=M(s),w=I(s);return{c(){e=g("div"),r=g("div"),r.innerHTML=l,a=j(),i=g("div"),t=g("button"),o=H("📥 กล่องข้อความ"),y=j(),n=g("button"),c=H("📤 ข้อความที่ส่ง"),b=j(),w.c(),this.h()},l(m){e=v(m,"DIV",{class:!0});var D=k(e);r=v(D,"DIV",{class:!0,"data-svelte-h":!0}),J(r)!=="svelte-sm362s"&&(r.innerHTML=l),a=N(D),i=v(D,"DIV",{class:!0});var B=k(i);t=v(B,"BUTTON",{class:!0});var O=k(t);o=q(O,"📥 กล่องข้อความ"),O.forEach(u),y=N(B),n=v(B,"BUTTON",{class:!0});var U=k(n);c=q(U,"📤 ข้อความที่ส่ง"),U.forEach(u),B.forEach(u),b=N(D),w.l(D),D.forEach(u),this.h()},h(){_(r,"class","flex justify-between items-center mb-8"),_(t,"class",p="flex-1 px-5 py-4 text-center transition-colors "+(s[2]==="inbox"?"bg-primary-700 text-white":"text-gray-600 hover:bg-gray-50")),_(n,"class",f="flex-1 px-5 py-4 text-center transition-colors "+(s[2]==="sent"?"bg-primary-700 text-white":"text-gray-600 hover:bg-gray-50")),_(i,"class","flex bg-white rounded-lg shadow-sm border border-gray-200 mb-5 overflow-hidden"),_(e,"class","max-w-4xl mx-auto")},m(m,D){T(m,e,D),d(e,r),d(e,a),d(e,i),d(i,t),d(t,o),d(i,y),d(i,n),d(n,c),d(e,b),w.m(e,null),V||(h=[G(t,"click",s[6]),G(n,"click",s[7])],V=!0)},p(m,[D]){D&4&&p!==(p="flex-1 px-5 py-4 text-center transition-colors "+(m[2]==="inbox"?"bg-primary-700 text-white":"text-gray-600 hover:bg-gray-50"))&&_(t,"class",p),D&4&&f!==(f="flex-1 px-5 py-4 text-center transition-colors "+(m[2]==="sent"?"bg-primary-700 text-white":"text-gray-600 hover:bg-gray-50"))&&_(n,"class",f),I===(I=M(m))&&w?w.p(m,D):(w.d(1),w=I(m),w&&(w.c(),w.m(e,null)))},i:K,o:K,d(m){m&&u(e),w.d(),V=!1,oe(h)}}}function z(s){return{super_admin:"ผู้ดูแลระบบสูงสุด",admin:"ผู้ดูแลระบบ",teacher:"ครู",parent:"ผู้ปกครอง",student:"นักเรียน"}[s]||s}function be(s,e,r){let l=null,a=[],i=!0,t="inbox";ce(async()=>{const{data:{session:h}}=await P.auth.getSession();if(!h){ue("/login");return}l=h.user,await o(),r(1,i=!1)});async function o(){if(!l)return;let h;t==="inbox"?h=P.from("messages").select(`
          *,
          sender:profiles!messages_sender_id_fkey (
            id,
            full_name,
            role
          )
        `).eq("recipient_id",l.id):h=P.from("messages").select(`
          *,
          recipient:profiles!messages_recipient_id_fkey (
            id,
            full_name,
            role
          )
        `).eq("sender_id",l.id);const{data:M,error:I}=await h.order("created_at",{ascending:!1});M&&r(0,a=M)}async function p(h){await P.from("messages").update({is_read:!0}).eq("id",h),await o()}async function y(h){confirm("คุณแน่ใจหรือไม่ที่จะลบข้อความนี้?")&&(await P.from("messages").delete().eq("id",h),await o())}function n(h){r(2,t=h),o()}return[a,i,t,p,y,n,()=>n("inbox"),()=>n("sent"),h=>p(h.id),h=>y(h.id)]}class De extends ae{constructor(e){super(),ie(this,e,be,ge,ne,{})}}export{De as component};
